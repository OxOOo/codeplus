<div class='panel panel-default cp-edit'>
  <form method="post" action="/modify_nickname">
    <div class='panel-heading'>
      昵称
      <i class="hide-on-edit edit-btn fa fa-pencil"></i>
      <button class="invisible show-on-edit done-btn" type="submit"><i class="fa fa-check"></i></button>
    </div>
    <div class='panel-body'>
      <div class="cp-input-group">
        <label>昵称</label>
        <div class="hide-on-edit"><%= user.nickname %></div>
        <input type="text" class="show-on-edit" name="nickname" value="<%= user.nickname %>">
      </div>
    </div>
  </form>
</div>

<div class='panel panel-default cp-edit'>
  <form method="post" action="/modify_email">
    <div class='panel-heading'>
      邮箱
      <i class="hide-on-edit edit-btn fa fa-pencil"></i>
      <button class="invisible show-on-edit done-btn" type="submit"><i class="fa fa-check"></i></button>
    </div>
    <div class='panel-body'>
      <div class="cp-input-group">
        <label>关联邮箱</label>
        <div class="hide-on-edit"><%= user.email || "暂无" %></div>
        <input type="text" class="show-on-edit" name="email" value="<%= user.email %>">
      </div>
    </div>
  </form>
</div>

<div class='panel panel-default cp-edit'>
  <form id="form-info" method="post" action="/modify_info">
    <div class='panel-heading'>
      基本资料
      <i class="hide-on-edit edit-btn fa fa-pencil"></i>
      <button class="invisible show-on-edit done-btn" type="submit"><i class="fa fa-check"></i></button>
    </div>
    <div class='panel-body'>
      <div class="cp-input-group">
        <label>真实姓名</label>
        <div class="hide-on-edit"><%= user.real_name || "不愿透露姓名的侠客" %></div>
        <input type="text" class="show-on-edit" name="real_name" value="<%= user.real_name %>">
      </div>
      <div class="cp-input-group">
        <label>学校</label>
        <div class="hide-on-edit"><%= user.school || "家里蹲" %></div>
        <input type="text" class="show-on-edit" name="school" value="<%= user.school %>">
      </div>
      <div class="cp-input-group">
        <label>性别</label>
        <div class="hide-on-edit"><%= user.sex || "未知" %></div>
        <select class="show-on-edit" name="sex" value="<%= user.sex %>">
          <option value="保密">保密</option>
          <option value="男">男</option>
          <option value="女">女</option>
          <option value="其他">其他</option>
        </select>
      </div>
      <div class="cp-input-group">
        <label>电话号码</label>
        <div class="hide-on-edit"><%= user.phone_number || "110" %></div>
        <input type="text" class="show-on-edit" name="phone_number" value="<%= user.phone_number %>">
      </div>
    </div>
  </form>
</div>

<script>
  $(function() {
    $('select').each(function() {
      let value = $(this).attr('value');
      if (!value) return;
      $(this).find('option[value="' + value + '"]').attr('selected', true);
    });
  });
</script>


<% if (normal_login) { %>
  <div class='panel panel-default cp-edit'>
    <form id="form-password" method="post" action="/modify_password">
    <div class='panel-heading'>
      帐号密码
      <i class="hide-on-edit edit-btn fa fa-pencil"></i>
      <button class="invisible show-on-edit done-btn" type="submit"><i class="fa fa-check"></i></button>
    </div>

    <div class='panel-body'>
      <div class="cp-input-group">
        <label>用户名</label>
        <div><%= normal_login.username %></div>
      </div>
      <div class="cp-input-group">
        <label>密码</label>
        <div class="hide-on-edit">[DELETED]</div>
        <input type="password" class="show-on-edit" name="password" id="password">
      </div>
      <div class="cp-input-group show-on-edit">
        <label>确认密码</label>
        <input type="password" class="show-on-edit" id="confirm_password">
      </div>
    </form>
  </div>
  <script>
    $(function () {
      $('#form-password').submit(function () {
        if ($('#password').val() != $('#confirm_password').val()) {
          alert('两次输入的密码不一致');
          return false;
        }
        return true;
      });
    });
  </script>
  <% } %>

<script>
$(function () {
  $('.cp-edit .edit-btn').click(function () {
    var $root = $(this).parents('.cp-edit');
    console.log($root);
    $root.toggleClass("editing");
  });
});
</script>
